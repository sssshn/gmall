<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
</head>
<body>
<div id="dlgForSpu1" class="easyui-dialog" title="平台属性" style="width:80%;height:500px;padding:10px"
     data-options="
                modal:true,
                closed:true,
                buttons: [{
                    text:'Save',
                    iconCls:'icon-ok',
                    handler:function(){
                        saveSpu();
                    }
                },{
                    text:'Exit',
                    iconCls:'icon-back',
                    handler:function(){
                        $('#dlgForSpu1').dialog('close');
                    }
                }]
            ">
    <div class="easyui-panel" style="width:100%;padding:5px;">
        <div style="margin-bottom:20px">
            <input id="spuName" class="easyui-textbox" label="SPU名称:" labelPosition="left" style="width:50%;"/>
        </div>
        <div>
            <input id="spuDescription" class="easyui-textbox" label="SPU描述:" labelPosition="left" multiline="true" style="width:50%;height:60px"/>
        </div>
    </div>
    <br/>
    <table id="dgForSpu1" class="easyui-datagrid" title="商品图片列表" style="width:100%;height:200px"
           data-options="fitColumns:true,singleSelect:true,toolbar:'#tbForSpu1',fitColumns:true,scrollbarSize:0">
    </table>

    <div id="tbForSpu1" style="padding:2px 5px;">
        <a href="javascript:addAttrValue()" class="easyui-linkbutton" iconCls="icon-add" plain="true">添加</a>
        <a href="javascript:delAttrValue()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
        <a href="javascript:delAttrValue()" class="easyui-linkbutton" iconCls="icon-save" plain="true">上传</a>
    </div>

    <table id="dgForSpu2" class="easyui-datagrid" title="销售品属性列表" style="width:100%;height:200px"
           data-options="fitColumns:true,singleSelect:true,toolbar:'#tbForSpu2',fitColumns:true,scrollbarSize:0">
    </table>

    <div id="tbForSpu2" style="padding:2px 5px;">
        <a href="javascript:addSpuSaleAttr()" class="easyui-linkbutton" iconCls="icon-add" plain="true">添加</a>
        <a href="javascript:delAttrValue()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">编辑</a>
        <a href="javascript:delAttrValue()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
    </div>

    <div th:include="spuSaleAttrPage"></div>
    
</div>

<script>
    //初始化商品图片表格
    function initSpuImgListDatagrid() {
        $('#dgForSpu1').datagrid({
            columns:[[
                {field:'id',title:'文件编号',width:80},
                {field:'imgName',title:'图片名称',width:80},
                {field:'process',title:'上传进度',width:80},
                {field:'processStatus',title:'上传状态',width:80},
                {field:'imgUrl',title:'',width:80,hidden:true}
            ]]
        });
    }

    //初始化销售属性表格
    function initSpuSaleAttrListDatagrid() {
        $('#dgForSpu2').datagrid({
            columns:[[
                {field:'id',title:'',width:80,hidden:true},
                {field:'saleAttrId',title:'销售属性ID',width:80},
                {field:'saleAttrName',title:'销售属性名称',width:80},
                {field:'spuSaleAttrValueJson',title:'销售属性暂存',width:80}
            ]]
        });
    }

    //打开销售属性dialog
    function addSpuSaleAttr() {
        $("#dlgForSpuSaleAttr").dialog('open');
        initSpuSaleAttrDlg();
        initSpuSaleAttrValueListDatagrid();
    }

    //保存SPU
    function saveSpu() {
         var spuRows = $('#dgForSpu2').datagrid('getRows');
         var description = $('#spuDescription').textbox('getValue');
         var spuName = $('#spuName').textbox('getValue');
         var catalog3Id = $("#ctg3ForSpuList").combobox('getValue');
        var spuInfo = {};
        spuInfo["spuName"] = spuName;
        spuInfo["description"] = description;
        spuInfo["catalog3Id"] = catalog3Id;
        $(spuRows).each(function (i,spuSaleAttr) {
            spuInfo["spuSaleAttrList["+ i +"].saleAttrId"] = spuSaleAttr.saleAttrId;
            spuInfo["spuSaleAttrList["+ i +"].saleAttrName"] = spuSaleAttr.saleAttrName;
            $(spuSaleAttr.spuSaleAttrValueJson.rows).each(function (j, spuSaleAttrValue) {
                spuInfo["spuSaleAttrList["+ i +"].spuSaleAttrValueList["+ j +"].saleAttrValueName"] = spuSaleAttrValue.saleAttrValueName;
                spuInfo["spuSaleAttrList["+ i +"].spuSaleAttrValueList["+ j +"].saleAttrId"] = spuSaleAttr.saleAttrId;
            });
        });

        $.post("saveSpu", spuInfo, function (data) {
           alert(data);
            $('#dlgForSpu1').dialog('close');
        });


    }

</script>

</body>
</html>